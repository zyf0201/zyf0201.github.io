<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>叶落</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="I am always here!!!">
<meta property="og:type" content="website">
<meta property="og:title" content="叶落">
<meta property="og:url" content="https://zyf0201.github.io/index.html">
<meta property="og:site_name" content="叶落">
<meta property="og:description" content="I am always here!!!">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Michael Zhang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="叶落" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">叶落</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Never Say Goodbye</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://zyf0201.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-iOS-distribution-introduce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/21/iOS-distribution-introduce/" class="article-date">
  <time class="dt-published" datetime="2021-10-21T06:56:01.000Z" itemprop="datePublished">2021-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/21/iOS-distribution-introduce/">iOS分发介绍</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>随着互联网技术的普及，越来越多的公司通过移动app来开展线上应用，同时随之而来就是设备的管理问题。苹果公司有很多终端产品，包括iPhone、Mac、iWatch、iPad等，同时还有很多app供用户下载使用，普通用户主要通过 App Store下载应用，除了App Store以外，苹果公司对于企业客户还专门推出了Apple商务管理计划，这篇文章会进行简单的介绍。</p>
</blockquote>
<h1 id="Apple分发简介"><a href="#Apple分发简介" class="headerlink" title="Apple分发简介"></a>Apple分发简介</h1><p>目前Apple主流的四种分发方式：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/cn/app-store/">App Store</a></li>
</ul>
<blockquote>
<p>作为用户探索和下载 app 的好去处，App Store 不仅安全可靠、值得信赖；它更提供了巨大的商机，让开发者能在 175 个地区提供面向 iPhone、iPad、Mac、Apple TV 及 Apple Watch 的 app 和服务。查看文章、指南及其他资源，从而帮助您设计出精彩绝伦的 app，触及更多用户，并不断发展您的业务。</p>
</blockquote>
<p>普通消费者主要通过App Store下载应用，或者也可以通过testflight将人员加入到测试名单进行测试分发，中国区apple id可以下载本区的的应用。</p>
<ul>
<li>Mac App Store</li>
</ul>
<blockquote>
<p>在 Mac App Store 中，客户能够简单容易地发现、购买和下载您的 app，并能轻松保持它们为最新状态。Mac App Store 会按照用户在 Mac 上喜欢做的事来归类整理各个 app，并提供深度报道、精选集和视频，以此出色展示您的 app，提升其曝光度。</p>
</blockquote>
<p>适用于mac用户，或者可以直接下载安装包进行安装</p>
<ul>
<li>分发自定App</li>
</ul>
<blockquote>
<p>与商务和教育机构客户接洽，根据他们所在组织的独特需求，为其设计和构建自定 app。通过 Apple 商务管理(简称ABM)和 Apple 校园教务管理，您不但能以安全私密的方式向特定的合作伙伴、客户和特许经营者进行分发，而且还能向内部员工分发专属 app。</p>
</blockquote>
<p>这类自定App主要是企业内部app，比如企业内部特定的办公软件，不对公众开放.针对企业内部的应用苹果主推的Apple商务管理分发(ABM)，客户使用ABM分发首先需要申请苹果企业账号，然后申请ABM证书。企业用户可以通过以兑换码的方式下载应用，具体操作请参考<a target="_blank" rel="noopener" href="https://support.apple.com/zh-cn/guide/apple-business-manager/asmc21817890/web">在 Apple 商务管理中选择和购买内容</a>。企业管理内部应用的实践可以参考：<a target="_blank" rel="noopener" href="https://blogs.vmware.com/china/2019/10/08/%E4%BC%81%E4%B8%9A%E9%87%87%E8%B4%AD%E8%8B%B9%E6%9E%9C%E8%AE%BE%E5%A4%87%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF-abm/">企业管理苹果设备的正确姿势 — ABM</a></p>
<p>Apple商务管理(ABM)介绍：<br>组织可以注册为 Apple 商务用户，以使用 Apple 商务管理来购买和分发内容，以及自动完成设备部署。您指定的组织可以在 Apple 商务管理的“内容”部分中看到和购买您的 app，并能通过移动设备管理对其进行无缝分发。或者，组织可以选择向授权用户提供兑换码，供他们从 App Store 下载相应的 app。</p>
<p>Apple 校园教务管理(ASM)介绍：<br>根据教育机构的个别需求，以非公开的方式向对方提供专为其量身定制的 app。您在 App Store Connect 中指定的组织将能够看到该 app 并在 Apple 校园教务管理中进行批量购买。通过 Apple 校园教务管理服务，教育机构可以购买内容、配置自动设备注册，并为学生和教职人员创建帐户。教育机构也可以使用这一功能来分发专属 app，供内部使用。</p>
<ul>
<li>Safari浏览器扩展</li>
</ul>
<blockquote>
<p>使用 Safari 扩展增强和自定义 Mac、iPhone 和 iPad 上的 Web 浏览体验。使用强大的原生 API 和框架，以及熟悉的 Web 技术（例如 HTML、CSS 和 JavaScript），您可以轻松地在 Xcode 中创建 Safari 扩展，并将它们分发到 App Store 的扩展类别中，或者让它们经过公证以便在 Mac 之外分发应用商店。 Xcode 12 及更高版本支持流行的 WebExtension API，并包含一个移植工具，可以轻松将您的扩展程序带到 Safari。</p>
</blockquote>
<h1 id="Apple分发方式介绍"><a href="#Apple分发方式介绍" class="headerlink" title="Apple分发方式介绍"></a>Apple分发方式介绍</h1><ul>
<li><p>App Store<br>通过 App Store Connect，您可以向 App Store 提交 App，审核通过后，然后上架App Store后供用户下载</p>
</li>
<li><p>TestFlight<br>通过 App Store Connect，您可以向 App Store 提交 App，然后在testflight添加测试人员进行测试，测试人员需要通过testflight下载对应的应用</p>
</li>
<li><p>In-house<br>使用In-house证书打包的iOS可以直接安装，但是目前官方已经关闭了In-house证书的申请途径</p>
</li>
<li><p>超级签名</p>
</li>
<li><p>ABM<br>Apple 商务管理是一个面向 IT 管理员的基于网页的简单门户，可提供一种快速、简便的方法来部署您所在组织的 Apple 设备（指直接从 Apple 购买或从加入该计划的 Apple 授权经销商或运营商处购买的设备）。您可以在移动设备管理 (MDM) 解决方案中自动注册设备，而无需在用户拿到设备前实际接触或设置设备。</p>
</li>
<li><p>ASM</p>
</li>
</ul>
<p>以下是各个分发方式的区别：</p>



<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c8361a83a338">iOS应用发布方式盘点+苹果商务详解</a><br><a target="_blank" rel="noopener" href="https://support.apple.com/zh-cn/guide/apple-business-manager/apdd344cdd9d/1/web/1">什么是 Apple 商务管理？</a><br><a target="_blank" rel="noopener" href="https://blogs.vmware.com/china/2019/10/08/%E4%BC%81%E4%B8%9A%E9%87%87%E8%B4%AD%E8%8B%B9%E6%9E%9C%E8%AE%BE%E5%A4%87%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF-abm/">企业管理苹果设备的正确姿势 — ABM</a><br><a target="_blank" rel="noopener" href="https://www.manageengine.cn/mobile-device-management/what-is-mdm.html">什么是MDM</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903969160986632">iOS MDM详解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/10/21/iOS-distribution-introduce/" data-id="cl74z4xih000hyc6l8y8i4gio" data-title="iOS分发介绍" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-github-dev" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/09/github-dev/" class="article-date">
  <time class="dt-published" datetime="2021-09-08T16:20:39.000Z" itemprop="datePublished">2021-09-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/09/github-dev/">GitHub Codespaces介绍</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.github.com/cn/codespaces/about-codespaces">Codespaces</a> 是一个可配置的在线开发环境，由 GitHub 托管并由 Visual Studio Code 支持，允许您完全在云端开发。</p>
</blockquote>
<p>通过codespace，可以直接在浏览器里面打开vscode，同时通过”<a target="_blank" rel="noopener" href="https://github.dev/[%E7%94%A8%E6%88%B7%E5%90%8D]/[%E4%BB%93%E5%BA%93%E5%90%8D]&quot;%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%89%93%E5%BC%80%E5%AF%B9%E5%BA%94%E4%BB%93%E5%BA%93">https://github.dev/[用户名]/[仓库名]&quot;就可以打开对应仓库</a></p>



      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/09/09/github-dev/" data-id="cl74z4xia0009yc6l8ia23sj5" data-title="GitHub Codespaces介绍" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-http-proxy" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/27/http-proxy/" class="article-date">
  <time class="dt-published" datetime="2021-05-27T02:17:55.000Z" itemprop="datePublished">2021-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/27/http-proxy/">配置HTTP正向代理服务器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>在政府金融行业，或者一些特殊的网络隔离情况下，内网主机是无法访问互联网的，这个时候就需要特定的正向代理服务器才能实现连接互联网的需求。Nginx是一个异步框架的网页服务器，也可以用作反向代理、负载平衡器和HTTP缓存，同时，Nginx也可以作为一个正向代理服务器。</p>
</blockquote>
<h1 id="HTTP-x2F-HTTPS-正向代理的分类"><a href="#HTTP-x2F-HTTPS-正向代理的分类" class="headerlink" title="HTTP &#x2F; HTTPS 正向代理的分类"></a>HTTP &#x2F; HTTPS 正向代理的分类</h1><ul>
<li><p>按客户端有无感知的分类</p>
<ul>
<li>普通代理：在客户端需要在浏览器中或者系统环境变量手动设置代理的地址和端口</li>
<li>透明代理：客户端不需要做任何代理设置，“代理”这个角色对于客户端是透明的。如企业网络链路中的 Web Gateway 设备。</li>
</ul>
</li>
<li><p>按代理是否解密 HTTPS 的分类</p>
<ul>
<li>隧道代理：也就是透传代理代理服务器只是在 TCP 协议上透传 HTTPS 流量，对于其代理的流量的具体内容不解密不感知客户端和其访问的目的服务器做直接 TLS &#x2F; SSL 交互本文中讨论的 NGINX 代理方式属于这种模式。</li>
<li>中间人（MITM，Man-in-the-Middle）代理：代理服务器解密 HTTPS 流量，对客户端利用自签名证书完成 TLS &#x2F; SSL 握手，对目的服务器端完成正常 TLS 交互。(注：这种情况客户端在 TLS 握手阶段实际上是拿到的代理服务器自己的自签名证书，证书链的验证默认不成功，需要在客户端信任代理自签证书的根 CA 证书。所以过程中是客户端有感的。如果要做成无感的透明代理，需要向客户端推送自建的根 CA 证书，在企业内部环境下是可实现的。)</li>
</ul>
</li>
</ul>
<h1 id="Nginx直接代理HTTP"><a href="#Nginx直接代理HTTP" class="headerlink" title="Nginx直接代理HTTP"></a>Nginx直接代理HTTP</h1><p>首先编译按安装nginx，我用tengine代替，以macos为例</p>
<blockquote>
<p>Tengine是一个由淘宝从Nginx复刻出来的HTTP服务器，现时版本为2.2.2。Tengine对Nginx的修改版本是于2011年12月开始释放出来成为开源项目，两者配置兼容。</p>
</blockquote>
<ul>
<li><p>tengine安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://tengine.taobao.org/download/tengine-2.3.3.tar.gz</span><br><span class="line">tar -xvf tengine-2.3.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> tengine-2.3.3</span><br><span class="line">./configure --with-cc-opt=<span class="string">&quot;-I/usr/local/opt/openssl/include/ -I/usr/local/opt/pcre/include/&quot;</span> \</span><br><span class="line">--with-ld-opt=<span class="string">&quot;-L/usr/local/opt/openssl/lib/ -L/usr/local/opt/pcre/lib/&quot;</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
</li>
<li><p>nginx.conf配置<br>http代理配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80;                #监听端口</span><br><span class="line">        resolver 8.8.8.8;   #dns解析地址</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://$http_host$request_uri;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试http代理连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -i参数打印出服务器回应的 HTTP 标头,-v参数输出通信的整个过程，用于调试</span><br><span class="line">curl http://www.sina.com -v -i --proxy 127.0.0.1:80</span><br></pre></td></tr></table></figure></li>
<li><p>查看对应的返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">*   Trying 127.0.0.1:80...</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 80 (#0)</span><br><span class="line">&gt; GET http://www.sina.com/ HTTP/1.1</span><br><span class="line">&gt; Host: www.sina.com</span><br><span class="line">&gt; User-Agent: curl/7.76.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Proxy-Connection: Keep-Alive</span><br><span class="line">&gt;</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: Tengine/2.3.3</span><br><span class="line">Server: Tengine/2.3.3</span><br><span class="line">&lt; Date: Mon, 31 May 2021 11:53:02 GMT</span><br><span class="line">Date: Mon, 31 May 2021 11:53:02 GMT</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">Content-Type: text/html</span><br><span class="line">&lt; Content-Length: 24000</span><br><span class="line">Content-Length: 24000</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">Connection: keep-alive</span><br><span class="line">&lt; Vary: Accept-Encoding</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">&lt; ETag: W/&quot;607e94fd-c2c&quot;V=5965C31</span><br><span class="line">ETag: W/&quot;607e94fd-c2c&quot;V=5965C31</span><br><span class="line">&lt; X-Powered-By: shci_v1.13</span><br><span class="line">X-Powered-By: shci_v1.13</span><br><span class="line">&lt; Expires: Mon, 31 May 2021 11:53:10 GMT</span><br><span class="line">Expires: Mon, 31 May 2021 11:53:10 GMT</span><br><span class="line">&lt; Cache-Control: max-age=120</span><br><span class="line">Cache-Control: max-age=120</span><br><span class="line">&lt; X-Via-SSL: ssl.25.sinag1.shx.lb.sinanode.com</span><br><span class="line">X-Via-SSL: ssl.25.sinag1.shx.lb.sinanode.com</span><br><span class="line">&lt; Edge-Copy-Time: 1622461870071</span><br><span class="line">Edge-Copy-Time: 1622461870071</span><br></pre></td></tr></table></figure>
</li>
<li><p>也可以通过修改本地hosts解析进行测试</p>
</li>
<li><p>http代理的原理</p>
</li>
</ul>


<blockquote>
<p>代理服务器类似于一个中间人的角色，假如我通过代理访问 A 网站（以<a target="_blank" rel="noopener" href="http://www.sina.com为例),对于/">www.sina.com为例），对于</a> A 来说，它会把代理当做客户端，完全察觉不到真正客户端的存在，这实现了隐藏客户端 IP 的目的。当然代理也可以修改 HTTP 请求头部，通过 X-Forwarded-IP 这样的自定义头部告诉服务端真正的客户端 IP。</p>
</blockquote>
<h1 id="Nginx代理HTTPS请求"><a href="#Nginx代理HTTPS请求" class="headerlink" title="Nginx代理HTTPS请求"></a>Nginx代理HTTPS请求</h1><p>之前我们搭建了http代理服务器，但是我们会发现上述的代理是无法代理https流量的，这是为什么呢？因为作为反向代理时，代理服务器通常终结（终止）HTTPS 加密流量，再转发给后端实例.HTTPS 流量的加解密和认证过程发生在客户端和反向代理服务器之间。<br>而作为正向代理在处理客户端发过来的流量时，HTTP 加密封装在了 TLS &#x2F; SSL 中，代理服务器无法看到客户端请求的 URL 中想要访问的域名，如下图。所以代理 HTTPS 流量，相比于 HTTP，需要做一些特殊处理。</p>


<p>这种代理的本质是中间人，而 HTTPS 网站的证书认证机制是中间人劫持的克星。普通的 HTTPS 服务中，服务端不验证客户端的证书，中间人可以作为客户端与服务端成功完成 TLS 握手；但是中间人没有证书私钥，无论如何也无法伪造成服务端跟客户端建立 TLS 连接。当然如果你拥有证书私钥，代理证书对应的 HTTPS 网站当然就没问题了。</p>
<h2 id="HTTP-CONNECT-隧道"><a href="#HTTP-CONNECT-隧道" class="headerlink" title="HTTP CONNECT 隧道"></a>HTTP CONNECT 隧道</h2><p>NGINX 解决 HTTPS 代理的方式都属于透传（隧道）模式，即不解密不感知上层流量。具体的方式有七层和四层的两类解决方案。</p>
<blockquote>
<p>HTTP 客户端通过 CONNECT 方法请求隧道代理创建一条到达任意目的服务器和端口的 TCP 连接，并对客户端和服务器之间的后继数据进行盲转发。</p>
</blockquote>
<ul>
<li>整个过程可以参考 HTTP 权威指南中的图：
<ul>
<li>客户端给代理服务器发送 HTTP CONNECT 请求。</li>
<li>代理服务器利用 HTTP CONNECT 请求中的主机和端口与目的服务器建立 TCP 连接。</li>
<li>代理服务器给客户端返回 HTTP 200 响应。</li>
<li>客户端和代理服务器建立起 HTTP CONNECT 隧道，HTTPS 流量到达代理服务器后，直接通过 TCP 透传远端目的服务器。代理服务器的角色是透传 HTTPS 流量，并不需要解密 HTTPS。</li>
</ul>
</li>
</ul>
<blockquote>
<p>NGINX 作为反向代理服务器，官方一直没有支持 HTTP CONNECT 方法。但是基于 NGINX 的模块化，可扩展性好的特性，阿里的 @chobits 提供了ngx_http_proxy_connect_module模块，来支持 HTTP CONNECT 方法，从而让 NGINX 可以扩展为正向代理。</p>
</blockquote>
<ul>
<li>tengine安装并启用ngx_http_proxy_connect_module</li>
</ul>
<blockquote>
<p>使用nginx也是一样的，但是暂时不要使用openresty，因为我用openresty+ngx_http_proxy_connect_module发现代理是有问题的，详细原因请参考此<a target="_blank" rel="noopener" href="https://github.com/chobits/ngx_http_proxy_connect_module/issues/26">链接</a></p>
</blockquote>
<p>macos为例，首先需要通过brew安装openssl和pcre</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新编译安装</span></span><br><span class="line">./configure --with-cc-opt=<span class="string">&quot;-I/usr/local/opt/openssl/include/ -I/usr/local/opt/pcre/include/&quot;</span> \</span><br><span class="line">--with-ld-opt=<span class="string">&quot;-L/usr/local/opt/openssl/lib/ -L/usr/local/opt/pcre/lib/&quot;</span></span><br><span class="line">--add-module=./modules/ngx_http_proxy_connect_module</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<ul>
<li>nginx.conf配置</li>
</ul>
<p>修改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;        #nginx worker 数量</span><br><span class="line">error_log logs/error.log;   #指定错误日志文件路径</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        resolver 8.8.8.8;   #dns解析地址</span><br><span class="line">        listen 443;          #代理监听端口</span><br><span class="line">        proxy_connect;</span><br><span class="line">        proxy_connect_allow            all;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass https://$host$request_uri;     #设定https代理服务器的协议和地址</span><br><span class="line">            proxy_set_header HOST $host;</span><br><span class="line">            proxy_buffers 256 4k;</span><br><span class="line">            proxy_max_temp_file_size 0k;</span><br><span class="line">            proxy_connect_timeout 30;</span><br><span class="line">            proxy_send_timeout 60;</span><br><span class="line">            proxy_read_timeout 60;</span><br><span class="line">            proxy_next_upstream error timeout invalid_header http_502;</span><br><span class="line">                &#125;</span><br><span class="line">            error_page   500 502 503 504  /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试连接<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://www.baidu.com -v -i --proxy 127.0.0.1:443</span><br></pre></td></tr></table></figure>

通过-v参数调试可以看到对应的连接过程，客户端首先跟代理服务器（127.0.0.1）建立HTTP CONNECT隧道，代理回复 HTTP &#x2F; 1.1 200 连接建立后就开始交互 TLS &#x2F; SSL 握手和流量了。</li>
</ul>
<h2 id="NGINX流（四层解决方案）"><a href="#NGINX流（四层解决方案）" class="headerlink" title="NGINX流（四层解决方案）"></a>NGINX流（四层解决方案）</h2><blockquote>
<p>NGINX 官方从 1.9.0 版本开始支持ngx_stream_core_module模块，模块默认不建立，需要配置时加上–with 流选项来开启。</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://nginx.org/en/docs/stream/ngx_stream_ssl_preread_module.html?spm=a2c4e.10696291.0.0.e01e19a41l7ou4">ngx_stream_ssl_preread_module</a> 模块</li>
</ul>
<p>要在不解密的情况下拿到 HTTPS 流量访问的域名，只有利用 TLS &#x2F; SSL 握手的第一个客户端 Hello 报文中的扩展地址 SNI（服务器名称指示）来获取.NGINX 官方从 1.11.5 版本开始支持利用ngx_stream_ssl_preread_module模块来获得这个能力，模块主要用于获取客户端 Hello 报文中的 SNI 和 ALPN 信息。对于 4 层正向代理来说，从客户端 Hello 报文中提取 SNI 的能力是至关重要的，否则 NGINX stream 的解决方案无法成立。同时这也带来了一个限制，要求所有客户端都需要在 TLS &#x2F; SSL 握手中带上 SNI 字段，否则 NGINX stream 代理完全没办法知道客户端需要访问的目的域名。</p>
<ul>
<li>重新编译安装tengine并启用ngx_stream_ssl_preread_module</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新编译安装，并增加--with-stream,--with-stream_ssl_preread_module,--with-stream_ssl_module参数</span></span><br><span class="line">./configure --with-cc-opt=<span class="string">&quot;-I/usr/local/opt/openssl/include/ -I/usr/local/opt/pcre/include/&quot;</span> \</span><br><span class="line">--with-ld-opt=<span class="string">&quot;-L/usr/local/opt/openssl/lib/ -L/usr/local/opt/pcre/lib/&quot;</span> \</span><br><span class="line">--add-module=./modules/ngx_http_proxy_connect_module \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-stream_ssl_preread_module \</span><br><span class="line">--with-stream_ssl_module</span><br></pre></td></tr></table></figure>

<ul>
<li><p>nginx.conf配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    resolver 8.8.8.8;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443;</span><br><span class="line">        ssl_preread on;</span><br><span class="line">        proxy_connect_timeout 5s;</span><br><span class="line">        proxy_pass $ssl_preread_server_name:$server_port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试连接</p>
</li>
</ul>
<p>四层正向代理是透传上层 HTTPS 流量，不需要 HTTP 连接来建立隧道，也就是说不需要客户端设置 HTTP（S）代理。如果我们在客户端手动设置 HTTP（S）代理是否能访问成功呢？我们可以用 curl –proxy 来设置代理为这个正向服务器访问测试，看看结果：</p>

<p>可以看到客户端试图于正向 NGINX 前建立 HTTP CONNECT 隧道，但是由于 NGINX 是透传，所以把 CONNECT 请求直接转发给了目的服务器。目的服务器不接受 CONNECT 方法，所以最终出现“curl: (56) Proxy CONNECT aborted”，导致访问不成功。</p>
<p>对于四层正向代理，NGINX对上层流量基本上是透传，也不需要HTTP CONNECT来建立隧道。适合于透明代理的模式，比如将访问的域名利用DNS解定向到代理服务器。我们可以通过在客户端绑定&#x2F;etc&#x2F;hosts中来模拟。</p>
<p>增加本地解析</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/hosts</span></span><br><span class="line">127.0.0.1 www.baidu.com</span><br></pre></td></tr></table></figure>

<p>直接curl测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">*   Trying 127.0.0.1:443...</span><br><span class="line">* Connected to www.baidu.com (127.0.0.1) port 443 (<span class="comment">#0)</span></span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http/1.1</span><br><span class="line">* TLSv1.3 (OUT), TLS handshake, Client hello (1):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Server hello (2):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Server finished (14):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span><br><span class="line">* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):</span><br><span class="line">* TLSv1.2 (OUT), TLS handshake, Finished (20):</span><br><span class="line">* TLSv1.2 (IN), TLS handshake, Finished (20):</span><br><span class="line">* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256</span><br><span class="line">* ALPN, server accepted to use http/1.1</span><br><span class="line">* Server certificate:</span><br><span class="line">*  subject: C=CN; ST=beijing; L=beijing; OU=service operation department; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com</span><br><span class="line">*  start <span class="built_in">date</span>: Apr  2 07:04:58 2020 GMT</span><br><span class="line">*  expire <span class="built_in">date</span>: Jul 26 05:31:02 2021 GMT</span><br><span class="line">*  subjectAltName: host <span class="string">&quot;www.baidu.com&quot;</span> matched cert<span class="string">&#x27;s &quot;*.baidu.com&quot;</span></span><br><span class="line"><span class="string">*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign Organization Validation CA - SHA256 - G2</span></span><br><span class="line"><span class="string">*  SSL certificate verify ok.</span></span><br><span class="line"><span class="string">&gt; GET / HTTP/1.1</span></span><br><span class="line"><span class="string">&gt; Host: www.baidu.com</span></span><br><span class="line"><span class="string">&gt; User-Agent: curl/7.76.1</span></span><br><span class="line"><span class="string">&gt; Accept: */*</span></span><br><span class="line"><span class="string">&gt;</span></span><br><span class="line"><span class="string">* Mark bundle as not supporting multiuse</span></span><br><span class="line"><span class="string">&lt; HTTP/1.1 200 OK</span></span><br><span class="line"><span class="string">HTTP/1.1 200 OK</span></span><br><span class="line"><span class="string">&lt; Accept-Ranges: bytes</span></span><br><span class="line"><span class="string">Accept-Ranges: bytes</span></span><br><span class="line"><span class="string">&lt; Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform</span></span><br><span class="line"><span class="string">Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform</span></span><br><span class="line"><span class="string">&lt; Connection: keep-alive</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string">&lt; Content-Length: 2443</span></span><br><span class="line"><span class="string">Content-Length: 2443</span></span><br><span class="line"><span class="string">&lt; Content-Type: text/html</span></span><br><span class="line"><span class="string">Content-Type: text/html</span></span><br><span class="line"><span class="string">&lt; Date: Tue, 01 Jun 2021 06:36:24 GMT</span></span><br><span class="line"><span class="string">Date: Tue, 01 Jun 2021 06:36:24 GMT</span></span><br><span class="line"><span class="string">&lt; Etag: &quot;588603eb-98b&quot;</span></span><br><span class="line"><span class="string">Etag: &quot;588603eb-98b&quot;</span></span><br><span class="line"><span class="string">&lt; Last-Modified: Mon, 23 Jan 2017 13:23:55 GMT</span></span><br><span class="line"><span class="string">Last-Modified: Mon, 23 Jan 2017 13:23:55 GMT</span></span><br><span class="line"><span class="string">&lt; Pragma: no-cache</span></span><br><span class="line"><span class="string">Pragma: no-cache</span></span><br><span class="line"><span class="string">&lt; Server: bfe/1.0.8.18</span></span><br><span class="line"><span class="string">Server: bfe/1.0.8.18</span></span><br><span class="line"><span class="string">&lt; Set-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/</span></span><br><span class="line"><span class="string">Set-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;百度一下，你就知道&lt;/title&gt;&lt;/head&gt; &lt;body link=#0000cc&gt; &lt;div id=wrapper&gt; &lt;div id=head&gt; &lt;div class=head_wrapper&gt; &lt;div class=s_form&gt; &lt;div class=s_form_wrapper&gt; &lt;div id=lg&gt; &lt;img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129&gt; &lt;/div&gt; &lt;form id=form name=f action=//www.baidu.com/s class=fm&gt; &lt;input type=hidden name=bdorz_come value=1&gt; &lt;input type=hidden name=ie value=utf-8&gt; &lt;input type=hidden name=f value=8&gt; &lt;input type=hidden name=rsv_bp value=1&gt; &lt;input type=hidden name=rsv_idx value=1&gt; &lt;input type=hidden name=tn value=baidu&gt;&lt;span class=&quot;bg s_ipt_wr&quot;&gt;&lt;input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus=autofocus&gt;&lt;/span&gt;&lt;span class=&quot;bg s_btn_wr&quot;&gt;&lt;input type=submit id=su value=百度一下 class=&quot;bg s_btn&quot; autofocus&gt;&lt;/span&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=u1&gt; &lt;a href=http://news.baidu.com name=tj_trnews class=mnav&gt;新闻&lt;/a&gt; &lt;a href=https://www.hao123.com name=tj_trhao123 class=mnav&gt;hao123&lt;/a&gt; &lt;a href=http://map.baidu.com name=tj_trmap class=mnav&gt;地图&lt;/a&gt; &lt;a href=http://v.baidu.com name=tj_trvideo class=mnav&gt;视频&lt;/a&gt; &lt;a href=http://tieba.baidu.com name=tj_trtieba class=mnav&gt;贴吧&lt;/a&gt; &lt;noscript&gt; &lt;a href=http://www.baidu.com/bdorz/login.gif?login&amp;amp;tpl=mn&amp;amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb&gt;登录&lt;/a&gt; &lt;/noscript&gt; &lt;script&gt;document.write(&#x27;</span>&lt;a href=<span class="string">&quot;http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u=&#x27;+ encodeURIComponent(window.location.href+ (window.location.search === &quot;</span><span class="string">&quot; ? &quot;</span>?<span class="string">&quot; : &quot;</span>&amp;<span class="string">&quot;)+ &quot;</span>bdorz_come=1<span class="string">&quot;)+ &#x27;&quot;</span> name=<span class="string">&quot;tj_login&quot;</span> class=<span class="string">&quot;lb&quot;</span>&gt;登录&lt;/a&gt;<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">                &lt;/script&gt; &lt;a href=//www.baidu.com/more/ name=tj_briicon class=bri style=&quot;display: block;&quot;&gt;更多产品&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=ftCon&gt; &lt;div id=ftConw&gt; &lt;p id=lh&gt; &lt;a href=http://home.baidu.com&gt;关于百度&lt;/a&gt; &lt;a href=http://ir.baidu.com&gt;About Baidu&lt;/a&gt; &lt;/p&gt; &lt;p id=cp&gt;&amp;copy;2017&amp;nbsp;Baidu&amp;nbsp;&lt;a href=http://www.baidu.com/duty/&gt;使用百度前必读&lt;/a&gt;&amp;nbsp; &lt;a href=http://jianyi.baidu.com/ class=cp-feedback&gt;意见反馈&lt;/a&gt;&amp;nbsp;京ICP证030173号&amp;nbsp; &lt;img src=//www.baidu.com/img/gs.gif&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</span></span><br><span class="line"><span class="string">* Connection #0 to host www.baidu.com left intact</span></span><br></pre></td></tr></table></figure>

<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/706196">使用NGINX作为HTTPS正向代理服务器</a><br><a target="_blank" rel="noopener" href="https://imququ.com/post/web-proxy.html">HTTP 代理原理及实现（一）</a><br><a target="_blank" rel="noopener" href="https://www.lagou.com/lgeduarticle/72755.html">搭建Nginx正向代理服务</a><br><a target="_blank" rel="noopener" href="https://bigzuo.github.io/2018/12/15/nginx-https-forward-proxy/">使用 Nginx 搭建 HTTPS 正向代理服务</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0%E6%8C%87%E7%A4%BA">服务器名称指示 (Server Name Indication)</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE%E5%8D%8F%E5%95%86">应用层协议协商 (Application-Layer Protocol Negotiation)</a><br><a target="_blank" rel="noopener" href="https://tengine.taobao.org/document_cn/proxy_connect_cn.html">proxy_connect</a><br><a target="_blank" rel="noopener" href="http://nginx.org/en/docs/stream/ngx_stream_ssl_preread_module.html?spm=a2c4e.10696291.0.0.e01e19a41l7ou4">Module ngx_stream_ssl_preread_module</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/05/27/http-proxy/" data-id="cl74z4xig000fyc6lfe09brfp" data-title="配置HTTP正向代理服务器" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http-proxy/" rel="tag">http proxy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openrestry/" rel="tag">openrestry</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-js-learning01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/04/js-learning01/" class="article-date">
  <time class="dt-published" datetime="2021-04-04T09:27:50.000Z" itemprop="datePublished">2021-04-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/04/js-learning01/">js-learning01</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/04/04/js-learning01/" data-id="cl74z4xii000jyc6l2u4134pz" data-title="js-learning01" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-vpc-design01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/vpc-design01/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T05:39:37.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/vpc-design01/">vpc-design01</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><p>传统数据中心网络的弊端</p>
</li>
<li><p>overlay网络</p>
</li>
<li><p>vpc</p>
</li>
<li><p>vpc相关功能</p>
</li>
<li><p>vpc设计</p>
</li>
<li><p>sdn控制器：pox Floodlight ect</p>
</li>
</ul>
<blockquote>
<p>目前各大云服务商都提供了VPC（Virtual Private Cloud）产品，VPC已经成为用户使用云首先需要考虑的云产品，甚至是比云主机更早需要考虑的云产品，可以说是基础中的基础。</p>
</blockquote>
<p>基础术语介绍：</p>
<h1 id="VPC基础"><a href="#VPC基础" class="headerlink" title="VPC基础"></a>VPC基础</h1><h2 id="VPC概念"><a href="#VPC概念" class="headerlink" title="VPC概念"></a>VPC概念</h2><p>VPC是一个让您能够在自己定义的逻辑隔离的虚拟网络中启动云资源的服务。您可以完全掌控您的虚拟联网环境，包括选择自己的 IP 地址范围、创建子网以及配置路由表和网络网关。</p>
<p>VPC可以认为是一个网络容器。用户可以免费开通这个容器，开通后再在这个容器中“放置”用户需要的云产品，比如云主机，负载均衡，云数据库等。VPC的基本组件包含路由器和交换机，下图是AWS一个VPC。</p>


<h2 id="经典网络"><a href="#经典网络" class="headerlink" title="经典网络"></a>经典网络</h2><p>经典网络：公有云上所有用户共享公共网络资源池，用户之间未做逻辑隔离。用户的内网IP由系统统一分配，相同的内网IP无法分配给不同用户。</p>
<p>各个公有云厂商早期都是在经典网络中分配云资源，各个租户可能是在同一个VLAN中启动各自的资源，隔离性差，而且存在严重的安全隐患。<br>下图是经典网络和VPC的对比：</p>

<p>对比可以看到，VPC优势明显，通过VPC，用户可以自由定义网段划分、IP地址和路由策略；安全方面，VPC可提供网络ACL及安全组的访问控制，VPC灵活性和安全性更高。可适用于对安全隔离性要求较高的业务、托管多层web应用、弹性混合云部署等使用场景中，符合金融、政企等行业的强监管、数据安全要求。</p>
<blockquote>
<p>既然VPC有这么多优势，那为什么</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/03/26/vpc-design01/" data-id="cl74z4xiz0016yc6lcr4pdhbx" data-title="vpc-design01" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-talk-about-mining" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/16/talk-about-mining/" class="article-date">
  <time class="dt-published" datetime="2021-03-16T12:18:03.000Z" itemprop="datePublished">2021-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/16/talk-about-mining/">说说挖矿</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/03/16/talk-about-mining/" data-id="cl74z4xiu0011yc6l9euedetm" data-title="说说挖矿" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BTC/" rel="tag">BTC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/" rel="tag">以太坊</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86%E8%B4%A7%E5%B8%81/" rel="tag">加密货币</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B8%81%E5%AE%89/" rel="tag">币安</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8C%96%E7%9F%BF/" rel="tag">挖矿</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-kubecm-introduce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/16/kubecm-introduce/" class="article-date">
  <time class="dt-published" datetime="2021-03-16T11:23:07.000Z" itemprop="datePublished">2021-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/16/kubecm-introduce/">使用kubecm管理多个Kubernetes集群</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>最近遇到需要切换多个Kubernetes集群的场景，发现了kubecm这个工具，可以轻松管理你的Kubeconfig文件，github地址：<a target="_blank" rel="noopener" href="https://github.com/sunny0826/kubecm">https://github.com/sunny0826/kubecm</a></p>
</blockquote>
<h2 id="Kubecm安装"><a href="#Kubecm安装" class="headerlink" title="Kubecm安装"></a>Kubecm安装</h2><ul>
<li><p>Macos安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install kubecm</span><br></pre></td></tr></table></figure>
</li>
<li><p>二进制下载安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux x86_64</span></span><br><span class="line">curl -Lo kubecm.tar.gz https://github.com/sunny0826/kubecm/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/kubecm_<span class="variable">$&#123;VERSION&#125;</span>_Linux_x86_64.tar.gz</span><br><span class="line"><span class="comment"># macos</span></span><br><span class="line">curl -Lo kubecm.tar.gz https://github.com/sunny0826/kubecm/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/kubecm_<span class="variable">$&#123;VERSION&#125;</span>_Darwin_x86_64.tar.gz</span><br><span class="line"><span class="comment"># windows</span></span><br><span class="line">curl -Lo kubecm.tar.gz https://github.com/sunny0826/kubecm/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/kubecm_<span class="variable">$&#123;VERSION&#125;</span>_Windows_x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux &amp; macos</span></span><br><span class="line">tar -zxvf kubecm.tar.gz kubecm</span><br><span class="line"><span class="built_in">cd</span> kubecm</span><br><span class="line">sudo <span class="built_in">mv</span> kubecm /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># windows</span></span><br><span class="line"><span class="comment"># Unzip kubecm.tar.gz</span></span><br><span class="line"><span class="comment"># Add the binary in to your $PATH</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kubecm-使用"><a href="#Kubecm-使用" class="headerlink" title="Kubecm 使用"></a>Kubecm 使用</h2><ul>
<li><p>Kubecm用法</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  kubecm [flags]</span><br><span class="line">  kubecm [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">    add         Merge configuration file with $HOME/.kube/config</span><br><span class="line">    alias       Generate alias for all contexts</span><br><span class="line">    clear       Clear lapsed context, cluster and user</span><br><span class="line">    completion  Generates bash/zsh completion scripts</span><br><span class="line">    create      Create new KubeConfig(experiment)</span><br><span class="line">    delete      Delete the specified context from the kubeconfig</span><br><span class="line">    help        Help about any command</span><br><span class="line">    list        List kubeconfig</span><br><span class="line">    merge       Merge the kubeconfig files in the specified directory</span><br><span class="line">    namespace   Switch or change namespace interactively</span><br><span class="line">    rename      Rename the contexts of kubeconfig</span><br><span class="line">    switch      Switch Kube Context interactively</span><br><span class="line">    version     Print version info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --config string   path of kubeconfig (default &quot;$HOME/.kube/config&quot;)</span><br><span class="line">  -h, --help   help for kubecm</span><br><span class="line"></span><br><span class="line">Use &quot;kubecm [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加集群连接信息<br>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubecm add -f test.yaml  <span class="comment">## test.yaml为Kubernets集群的连接信息</span></span><br></pre></td></tr></table></figure>
<p>输入上述命令后会提示是否覆盖$HOME&#x2F;.kube&#x2F;config文件，如果选择flase，则会在本地生成.&#x2F;config.yaml</p>
</li>
<li><p>罗列所有集群信息</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubecm list</span><br></pre></td></tr></table></figure>


<ul>
<li><p>切换集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubecm switch</span><br></pre></td></tr></table></figure>
<p>根据箭头切换集群信息</p>
</li>
<li><p>删除集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubecm delete</span><br></pre></td></tr></table></figure>
<p>根据箭头删除对应的集群</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/03/16/kubecm-introduce/" data-id="cl74z4xio000qyc6l1ksphznd" data-title="使用kubecm管理多个Kubernetes集群" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubecm/" rel="tag">kubecm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-mz-2020-summary" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/24/mz-2020-summary/" class="article-date">
  <time class="dt-published" datetime="2021-02-24T10:01:08.000Z" itemprop="datePublished">2021-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/24/mz-2020-summary/">我的2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>2021已经过去了3个月有余，一直想对2020年做一个总结，拖着拖着就拖到了今天。</p>
</blockquote>
<p>回想2020年，可以用“新的开始”来形容，来到了一个全新的平台，更大的舞蹈，也是更大的挑战。</p>


<p>时间退回到2019年的年中，那个时候做了一个此生难忘的决定，从事培训行业，于是乎，来到了一家从事ICT培训的公司，平台貌似也挺大。那时候整个集团都在“all in cloud”的号召下，传统CT行业似乎渐渐走到了尽头（除了5G）。在云计算的席卷下，各种关于公有云的产品和理念扑面而来，而我们正是云培训部门，而我从事了多年的云平台的管理经验，正好碰上了这个浪潮。说到云的理念，我只是了然于胸，只是知道云就是这样一回事，对于云计算的理论，我是云里雾里的。而通过这次的培训经历，我接触和学习了各种云计算的理论和课程，渐渐得理论结合曾经的实操，对于云计算的本质似乎更加透彻!</p>


<p>从事了一年的培训之后，发现渐渐怀念曾今的工作状态，纸上得来总觉浅，于是乎，我渐渐暗下决心回到过去。当时正是疫情状态，虽然远程办公远程培训更多得出现在我们的工作中，但是明显感觉比以前更忙了。</p>
<p>在经过多轮的面试之后，我最终还是换了工作，来到了一个更大的圈子，从事于更偏应用层方面的交付，虽然我个人的意愿比较倾向于云计算方面的工作，但是对于已经了解过底层运维和云运维的我来说，再了解一下应用方面的交付运维也算是大满贯了!</p>
<p>新的公司氛围很好，工作时间非常弹性，适应得也很快，工作内容更倾向于业务方向，技术方面的内容不需要参与太多。</p>
<p>因为之前有培训相关的经验，针对我们产品的课程认证工作也自然落在了我头上，有一种似曾相识的感觉。</p>


<p>说完工作，再谈一下感情生活，来到新公司后因为偶然的一次机会，发生了一段美好而短暂的感情，没有最终成功，却让我心神俱碎。回想过去的感情，还是要克制自己的倔强。</p>


<p>至于生活方面，来到新公司后重新找到了篮球组织，可以每周一次运动，强身健体。也认识了很多新的伙伴，这真的很美好…</p>
<p>新的一年又来了，在处理好工作的同时，我又得完善一下自己的知识图谱了，学无止境，吾将上下而求索！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/02/24/mz-2020-summary/" data-id="cl74z4xir000uyc6l2tdp51gn" data-title="我的2020" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-helm-introduce02" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/24/helm-introduce02/" class="article-date">
  <time class="dt-published" datetime="2021-02-24T09:59:44.000Z" itemprop="datePublished">2021-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/24/helm-introduce02/">helm-introduce02</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/02/24/helm-introduce02/" data-id="cl74z4xid000dyc6l49zk6ay1" data-title="helm-introduce02" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-helm-introduce01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/06/helm-introduce01/" class="article-date">
  <time class="dt-published" datetime="2021-02-06T11:59:51.000Z" itemprop="datePublished">2021-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/06/helm-introduce01/">Helm介绍01-初识Helm</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Helm介绍"><a href="#Helm介绍" class="headerlink" title="Helm介绍"></a>Helm介绍</h2><h3 id="Helm概念"><a href="#Helm概念" class="headerlink" title="Helm概念"></a>Helm概念</h3><blockquote>
<p>Helm 是 Deis 开发的一个用于 Kubernetes 应用的包管理工具，主要用来管理 Charts。有点类似于 Ubuntu 中的 APT 或 CentOS 中的 YUM。Helm Chart 是用来封装 Kubernetes 原生应用程序的一系列 YAML 文件。可以在你部署应用的时候自定义应用程序的一些 Metadata，以便于应用程序的分发。对于应用发布者而言，可以通过 Helm 打包应用、管理应用依赖关系、管理应用版本并发布应用到软件仓库。对于使用者而言，使用 Helm 后不用需要编写复杂的应用部署文件，可以以简单的方式在 Kubernetes 上查找、安装、升级、回滚、卸载应用程序。</p>
</blockquote>
<h3 id="Helm架构"><a href="#Helm架构" class="headerlink" title="Helm架构"></a>Helm架构</h3>

<p>Helm由两部分组成：<strong>Helm Client</strong> 和 <strong>Tiller Server</strong>，Client负责管理 chart，而Server端负责管理 release。</p>
<ul>
<li><p>Helm Client 是最终用户的命令行客户端。客户端负责以下部分：</p>
<ul>
<li>本地 chart 开发</li>
<li>管理存储库</li>
<li>与 Tiller 服务交互</li>
<li>发送要安装的 chart</li>
<li>查询有关发布的信息</li>
<li>请求升级或卸载现有 release</li>
</ul>
</li>
</ul>
<blockquote>
<p>Chart：一个 Helm 包，其中包含了运行一个应用所需要的工具、资源定义等，还可能包含 Kubernetes 集群中的服务定义，类似 APT 的 dpkg 或者 Yum 的 RPM 文件，</p>
</blockquote>
<ul>
<li><p>Tiller Server 是一个集群内服务，与 Helm 客户端进行交互，并与 Kubernetes API 服务进行交互。服务负责以下内容：</p>
<ul>
<li>监听来自 Helm 客户端的传入请求</li>
<li>结合 chart 和配置来构建发布</li>
<li>将 chart 安装到 Kubernetes 中，然后跟踪后续 release</li>
<li>通过与 Kubernetes 交互来升级和卸载 chart</li>
</ul>
</li>
</ul>
<blockquote>
<p>Release: 在 Kubernetes 集群上运行的 Chart 的一个实例。在同一个集群上，一个 Chart 可以安装很多次。每次安装都会创建一个新的 release。</p>
</blockquote>
<p><em>Helm 整个系统的主要任务就是，在仓库中查找需要的 Chart，然后把 Chart 以 Release 的形式安装到 Kubernetes 之中</em></p>
<p>Helm 客户端使用 Go 编程语言编写，并使用 gRPC 协议套件与 Tiller 服务进行交互。</p>
<p>Tiller 服务也用 Go 编写。它提供了一个与客户端连接的 gRPC 服务，它使用 Kubernetes 客户端库与 Kubernetes 进行通信。目前，该库使用 REST + JSON。</p>
<p>Tiller 服务将信息存储在位于 Kubernetes 内的 ConfigMaps 中。它不需要自己的数据库。</p>
<h2 id="Helm安装"><a href="#Helm安装" class="headerlink" title="Helm安装"></a>Helm安装</h2><h3 id="二进制版本安装"><a href="#二进制版本安装" class="headerlink" title="二进制版本安装"></a>二进制版本安装</h3><ul>
<li>下载对应<a target="_blank" rel="noopener" href="https://github.com/helm/helm/releases">需要的版本</a></li>
<li>解压对应的tar包</li>
<li>在解压目中找到helm程序，移动到需要的目录中</li>
</ul>
<h3 id="脚本安装"><a href="#脚本安装" class="headerlink" title="脚本安装"></a>脚本安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br><span class="line"><span class="built_in">chmod</span> 700 get_helm.sh</span><br><span class="line">./get_helm.sh</span><br></pre></td></tr></table></figure>

<h3 id="通过包管理器安装"><a href="#通过包管理器安装" class="headerlink" title="通过包管理器安装"></a>通过包管理器安装</h3><ul>
<li>macos安装</li>
</ul>
<p>brew install helm</p>
<ul>
<li>Debian&#x2F;Ubuntu</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl https://baltocdn.com/helm/signing.asc | sudo apt-key add -</span><br><span class="line">sudo apt-get install apt-transport-https --yes</span><br><span class="line">echo &quot;deb https://baltocdn.com/helm/stable/debian/ all main&quot; | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install helm</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/intro/install/">其他安装方式</a></li>
</ul>
<h2 id="Helm使用"><a href="#Helm使用" class="headerlink" title="Helm使用"></a>Helm使用</h2><p>使用Helm的先决条件：</p>
<ul>
<li>使用Helm，需要一个Kubernetes集群(最简单的是自己装一个minikube，或者自己通过虚拟机搭建一个单节点的kubernetes,可以使用<a target="_blank" rel="noopener" href="https://github.com/caoyingjunz/kubez-ansible">kubez-ansible</a>快速搭建)，也应该有一个本地的 kubectl</li>
<li>安装和配置Helm</li>
</ul>
<h3 id="Helm初始化"><a href="#Helm初始化" class="headerlink" title="Helm初始化"></a>Helm初始化</h3><p>安装Helm后，可以添加一个chart仓库,一个常见的选择是添加Helm的官方仓库:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add stable https://charts.helm.sh/stable</span><br></pre></td></tr></table></figure>

<p>可以看到可以被您安装的charts列表：</p>


<h3 id="使用Helm安装一个release"><a href="#使用Helm安装一个release" class="headerlink" title="使用Helm安装一个release"></a>使用Helm安装一个release</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 在chart仓库中搜索mysql</span></span><br><span class="line">helm search repo mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用helm安装mysql</span></span><br><span class="line">helm install stable/mysql --generate-name</span><br></pre></td></tr></table></figure>



<p>通过helm ls可以查看已经创建的release</p>


<blockquote>
<p>所以，通过Helm就可以快速部署一个自己所需要的组件应用，节省大部分时间。可以为自己的应用编写chart，并快速发布。</p>
</blockquote>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/intro/quickstart/">快速入门指南</a><br><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/intro/using_helm/">使用Helm</a><br><a target="_blank" rel="noopener" href="https://whmzsu.github.io/helm-doc-zh-cn/architecture-zh_cn.html">Kubernetes Helm 架构</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zyf0201.github.io/2021/02/06/helm-introduce01/" data-id="cl74z4xic000byc6la40k0pf1" data-title="Helm介绍01-初识Helm" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/helm/" rel="tag">helm</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/" rel="tag">AWS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/" rel="tag">Ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BTC/" rel="tag">BTC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GCP/" rel="tag">GCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PPT/" rel="tag">PPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diary/" rel="tag">diary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/helm/" rel="tag">helm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http-proxy/" rel="tag">http proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubecm/" rel="tag">kubecm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openrestry/" rel="tag">openrestry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/photography/" rel="tag">photography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/" rel="tag">以太坊</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86%E8%B4%A7%E5%B8%81/" rel="tag">加密货币</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%81%E5%AE%89/" rel="tag">币安</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%96%E7%9F%BF/" rel="tag">挖矿</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%85%E6%B8%B8/" rel="tag">旅游</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" rel="tag">比特币</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/" rel="tag">知识管理</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AWS/" style="font-size: 10px;">AWS</a> <a href="/tags/Ansible/" style="font-size: 10px;">Ansible</a> <a href="/tags/BTC/" style="font-size: 10px;">BTC</a> <a href="/tags/DevOps/" style="font-size: 10px;">DevOps</a> <a href="/tags/GCP/" style="font-size: 10px;">GCP</a> <a href="/tags/Kubernetes/" style="font-size: 13.33px;">Kubernetes</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/diary/" style="font-size: 20px;">diary</a> <a href="/tags/github/" style="font-size: 13.33px;">github</a> <a href="/tags/helm/" style="font-size: 10px;">helm</a> <a href="/tags/http-proxy/" style="font-size: 10px;">http proxy</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/kubecm/" style="font-size: 10px;">kubecm</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/openrestry/" style="font-size: 10px;">openrestry</a> <a href="/tags/photography/" style="font-size: 10px;">photography</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/" style="font-size: 10px;">以太坊</a> <a href="/tags/%E5%8A%A0%E5%AF%86%E8%B4%A7%E5%B8%81/" style="font-size: 10px;">加密货币</a> <a href="/tags/%E5%B8%81%E5%AE%89/" style="font-size: 10px;">币安</a> <a href="/tags/%E6%8C%96%E7%9F%BF/" style="font-size: 10px;">挖矿</a> <a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 10px;">旅游</a> <a href="/tags/%E6%AF%94%E7%89%B9%E5%B8%81/" style="font-size: 10px;">比特币</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/" style="font-size: 16.67px;">知识管理</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/21/iOS-distribution-introduce/">iOS分发介绍</a>
          </li>
        
          <li>
            <a href="/2021/09/09/github-dev/">GitHub Codespaces介绍</a>
          </li>
        
          <li>
            <a href="/2021/05/27/http-proxy/">配置HTTP正向代理服务器</a>
          </li>
        
          <li>
            <a href="/2021/04/04/js-learning01/">js-learning01</a>
          </li>
        
          <li>
            <a href="/2021/03/26/vpc-design01/">vpc-design01</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 Michael Zhang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>